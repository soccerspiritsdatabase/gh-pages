angular.module("app",["templates","ui.router","ngStorage"]),angular.module("app").config(["$compileProvider","$stateProvider","$urlRouterProvider",function(e,t,n){e.debugInfoEnabled(!1),n.otherwise("/characters"),t.state("characters",{url:"/characters",templateUrl:"routes/characters/characters.html",controller:"CharactersController as ctrl"}).state("character-details",{url:"/characters/details/:characterId",templateUrl:"routes/character-details/character-details.html",controller:"CharacterDetailsController as ctrl"}).state("spirit-stones",{url:"/spiritstones",templateUrl:"routes/spirit-stones/spirit-stones.html",controller:"SpiritStonesController as ctrl"}).state("rankings",{url:"/rankings",templateUrl:"routes/rankings/rankings.html",controller:"RankingsController as ctrl"})}]),angular.module("app").service("Calculator",function(){function e(e,t){return t/10>e&&(e=Math.ceil(t/10)),Math.min(1,Math.pow(.176,(6-e)/10))}function t(e,t){return isNaN(t)?Math.round(e):Math.round(e*t)/t}var n=this,r=60,a={LWF:{dribble:.1,hp:.05,actionSpeed:.1,critical:.05},ST:{dribble:.1,actionSpeed:.05,critical:.1,steal:.05},SS:{dribble:.05,defense:.05,actionSpeed:.1,critical:.05,reflex:.05},RWF:{dribble:.1,hp:.05,actionSpeed:.1,critical:.05},LWM:{dribble:.05,hp:.05,recovery:.05,actionSpeed:.05,critical:.05,reflex:.05,pass:.05},CAM:{dribble:.05,recovery:.05,actionSpeed:.05,critical:.1,reflex:.05,pass:.05},CM:{dribble:.05,defense:.05,recovery:.1,reflex:.05,pass:.1,steal:.05},RWM:{dribble:.05,hp:.05,recovery:.05,actionSpeed:.05,critical:.05,reflex:.05,pass:.05},LM:{dribble:.05,defense:.05,recovery:.1,reflex:.05,pass:.1,steal:.05},RM:{dribble:.05,defense:.05,recovery:.1,reflex:.05,pass:.1,steal:.05},CDM:{defense:.1,hp:.05,reflex:.1,steal:.05},LWB:{dribble:.05,defense:.05,hp:.05,recovery:.05,reflex:.1,pass:.05},RWB:{dribble:.05,defense:.05,hp:.05,recovery:.05,reflex:.1,pass:.05},LB:{defense:.05,hp:.1,recovery:.05,reflex:.05,pass:.05,steal:.05},CB:{defense:.1,hp:.1,reflex:.05,steal:.05},RB:{defense:.05,hp:.1,recovery:.05,reflex:.05,pass:.05,steal:.05},GK:{defense:.15,hp:.3,steal:.05}};n.calcPrimaryStat=function(t,n,a,i,l){var o=Math.floor(t[n].min*e(t.value,a)),s=t[n].max,c=s-o,u=c/(r-1),m=Math.floor(o+u*(a-1));return!isNaN(i)&&i>0&&(m=Math.floor(m+.1*m*i)),!isNaN(l)&&l>0&&(m=Math.floor(m+l)),m},n.calcSecondaryStats=function(e,n,r,i,l,o){var s={dribble:{value:Math.floor(5+e+.2*i)},defense:{value:Math.floor(.2*r+.8*n)},steal:{value:Math.floor(5+n+.2*i)},hp:{value:Math.floor(20+.8*l+Math.round(1.8*r))},pass:{value:Math.floor(3+.8*n)},reflex:{value:Math.floor((5+n+i/12)/4/(l+30)*1e3)},actionSpeed:{value:Math.floor(30+.1*i)},recovery:{value:.03+.002*(e+r)},critical:{value:.05+.001*(.3*e+.8*n+.4*i)}};if(o&&o.name&&a[o.name]){var c=a[o.name];Object.keys(c).forEach(function(e){var t=c[e];t*=o.main?2:1.5,"critical"===e?s[e].value+=t:(s[e].value+=s[e].value*t,"recovery"!==e&&(s[e].value=Math.floor(s[e].value))),s[e].positionBuff=!0})}return s.recovery.value=t(s.recovery.value,100),s.critical.value=t(100*s.critical.value,10)+"%",s}}),angular.module("app").service("Characters",["$http","$q","Skills",function(e,t,n){var r,a,i=this,l=e.get("data/json_files/characters.json").success(function(e){r=e,a=Object.keys(r).map(function(e){return r[e]}).sort(function(e,t){return e.name.en<t.name.en?-1:e.name.en>t.name.en?1:e.value>t.value?-1:e.value<t.value?1:e.id<t.id?-1:e.id>t.id?1:0})});i.get=function(e){return l.then(function(){return angular.copy(r[e])})},i.getAll=function(e){var t=[];if(e.name){var r=new RegExp(e.name.split(/\s+/).join(".*"),"i");t.push(function(e){return e.name.en.match(r)})}["characterType","gender","type","element","value","stoneElements","season","weatherImmunity"].forEach(function(n){e[n]&&t.push(function(t){if(!t[n])return!1;if(Array.isArray(e[n])){if(0===e[n].length)return!0;var r="stoneElements"===n?"every":"some";return e[n][r](function(e){return Array.isArray(t[n])?t[n].some(function(t){return t==e}):t[n]==e})}return Array.isArray(t[n])?t[n].some(function(t){return t==e[n]}):t[n]==e[n]})}),["isSpecial"].forEach(function(n){"boolean"==typeof e[n]&&t.push(function(t){return t[n]==e[n]})}),t.push(function(t){return void 0!==e.extremeEvolution&&t.isPlayer?e.extremeEvolution?t.id>=3e4&&t.id<4e4:t.id>=2e4&&t.id<3e4&&!t.evolution:t.isPlayer||t.isManager?!t.evolution:!0});var i=l;return e.skill&&(e.skill.ace&&(i=i.then(function(){return n.getAll({type:"Ace",description:e.skill.ace})}).then(function(e){t.push(function(t){return t.skills.ace&&e.some(function(e){return e.id===t.skills.ace})})})),e.skill.active&&(i=i.then(function(){return n.getAll({type:"Active",description:e.skill.active})}).then(function(e){t.push(function(t){return t.skills.active&&e.some(function(e){return e.id===t.skills.active})})})),e.skill.passive&&(i=i.then(function(){return n.getAll({type:"Passive",description:e.skill.passive})}).then(function(e){t.push(function(t){return t.skills.passives&&e.some(function(e){return t.skills.passives.some(function(t){return t===e.id})})})}))),i.then(function(){var e;return e=t.reduce(function(e,t){return e.filter(t)},a)})}}]),angular.module("app").service("Evolutions",["$http","$q","Characters",function(e,t,n){function r(e){return e?t.all(e.materials.map(function(e){return n.get(e.character)})).then(function(t){return e.materials.forEach(function(e,n){e.character=t[n]}),e}):null}var a,i,l=this,o=e.get("data/json_files/evolutions.json").success(function(e){a=e,i=Object.keys(a).map(function(e){return a[e]})});l.get=function(e){return o.then(function(){for(var t=0;t<i.length;t++)if(i[t].preResult===e)return r(angular.copy(i[t]));return null})},l.reverse=function(e){return o.then(function(){for(var t=0;t<i.length;t++)if(i[t].result===e)return r(angular.copy(i[t]));return null})}}]),angular.module("app").service("ImageIcons",function(){var e=this;e.get=function(e,t){return e&&t?["img/icons/",e.toLowerCase(),"/",t.toLowerCase(),".png"].join(""):""}}),angular.module("app").service("Skills",["$http","$q",function(e,t){var n,r,a=this,i=e.get("data/json_files/skills.json").success(function(e){n=e,r=Object.keys(n).map(function(e){return n[e]})});a.get=function(e){return i.then(function(){return angular.copy(n[e])})},a.getAll=function(e){var t=[];if(["type"].forEach(function(n){e[n]&&t.push(function(t){return t[n]===e[n]})}),e.description)try{var n=e.description.split(/\s+/).map(function(e){return new RegExp(e,"i")});t.push(function(e){return n.every(function(t){return e.description.en.match(t)})})}catch(a){}return i.then(function(){var e;return e=t.reduce(function(e,t){return e.filter(t)},r)})}}]),angular.module("app").service("SpiritStones",["$http","$q","Skills","ImageIcons",function(e,t,n,r){var a,i,l=this,o=e.get("data/json_files/spiritStones.json").success(function(e){i=e,a=Object.keys(i).map(function(e){return i[e]}).filter(function(e){return e.value>=6}).sort(function(e,t){return e.name.en<t.name.en?-1:e.name.en>t.name.en?1:e.value<t.value?-1:e.value>t.value?1:e.id<t.id?-1:e.id>t.id?1:0}),a.forEach(function(e){"Unique"===e.rarity?e.iconImage=r.get("stone",e.iconImage):e.iconImage=r.get("stone",e.element+"-"+e.rarity),e.zodiac&&(e.zodiacImage=r.get("stone",e.zodiac))})});l.getAll=function(e){e||(e={});var t=[];if(e.name){var r=new RegExp(e.name.split(/\s+/).join(".+"),"i");t.push(function(e){return e.name.en.match(r)})}["element","zodiac","rarity"].forEach(function(n){e[n]&&t.push(function(t){return t[n]===e[n]})});var i=o;return e.skill&&(i=i.then(function(){return n.getAll({type:"Item",description:e.skill})}).then(function(e){t.push(function(t){return t.skills.some(function(t){return e.some(function(e){return e.id===t})})})})),i.then(function(){return t.reduce(function(e,t){return e.filter(t)},a)})}}]),angular.module("app").service("TimeLogger",["$http","$q",function(e,t){var n=this,r={};n.start=function(e){r[e]=(new Date).getTime()},n.end=function(e){console.log("[TimeLogger]",e,(new Date).getTime()-r[e]+"ms")}}]),angular.module("app").directive("characterCard",["$window","$timeout","Characters",function(e,t,n){return{restrict:"E",scope:{model:"=ngModel"},templateUrl:"components/character-card/character-card.html",link:function(r,a){function i(e){r.character=e,r.image={},r.image.character="data/card_files/"+r.character.imageId+"_CS.jpg",r.image.star="img/icons/star/";var n=Math.floor(r.character.id/1e4)%3;e.isOther||1===n?r.image.star+="normal":2===n?r.image.star+="evolved":r.image.star+="extreme-evolved",r.image.star+=".png",r.stars=[];for(var a=0;a<r.character.value;a++)r.stars.push(a);t(l,10)}function l(e){console.log("calculate font size"),r.fontSize=Math.min(25,a[0].clientWidth/10)+"px",e&&r.$apply()}r.$watch("model",function(e){e&&(isNaN(e)?i(e):n.get(e).then(i))}),e.addEventListener("resize",l),r.$on("$destroy",function(){e.removeEventListener("resize",l)})}}}]),angular.module("app").directive("characterChainsTab",["Calculator",function(e){return{restrict:"E",scope:{character:"=ngModel"},templateUrl:"components/character-chains-tab/character-chains-tab.html",link:function(e,t){e.$watch("character",function(t){t&&t.chain&&t.chain.chains&&(e.chains=t.chain.chains)})}}}]),angular.module("app").directive("characterEvolutionTab",["$q","Evolutions",function(e,t){function n(e){return t.reverse(e).then(function(t){return t?n(t.preResult):e})}function r(e,n){return n||(n=[]),t.get(e).then(function(e){return e?(n.push(e),r(e.result,n)):n})}return{restrict:"E",scope:{character:"=ngModel"},templateUrl:"components/character-evolution-tab/character-evolution-tab.html",link:function(e,t){e.$watch("character",function(t){t&&n(t.id).then(function(e){return r(e)}).then(function(t){e.evolutions=t})})}}}]),angular.module("app").directive("characterSkill",["$q","Skills",function(e,t){return{restrict:"E",scope:{skillId:"=ngModel"},templateUrl:"components/character-skill/character-skill.html",link:function(e,n){e.$watch("skillId",function(n){n&&t.get(n).then(function(t){e.skill=t,e.levelIndex=t.effects.length-1,t.cooldown>60?e.cooldown={value:t.cooldown/3600,unit:" hour"}:e.cooldown={value:t.cooldown,unit:" min"},1!==e.cooldown.value&&(e.cooldown.unit+="s")})})}}}]),angular.module("app").directive("characterSkillsTab",["$q","Skills",function(e,t){return{restrict:"E",scope:{character:"=ngModel"},templateUrl:"components/character-skills-tab/character-skills-tab.html",link:function(e,t){}}}]),angular.module("app").directive("characterStatsTab",["Calculator",function(e){return{restrict:"E",scope:{character:"=ngModel"},templateUrl:"components/character-stats-tab/character-stats-tab.html",link:function(t,n){function r(n,r){["power","technique","vitality","speed"].forEach(function(a){t.stats[a].value=e.calcPrimaryStat(n,a,r.level,r.superb,r.bonus[a])});var a=e.calcSecondaryStats(t.stats.power.value,t.stats.technique.value,t.stats.vitality.value,t.stats.speed.value,r.level,r.position);t.secondaryStats=[[angular.merge({name:"Dribble"},a.dribble),angular.merge({name:"Defense"},a.defense)],[angular.merge({name:"Steal"},a.steal),angular.merge({name:"HP"},a.hp)],[angular.merge({name:"Pass"},a.pass),angular.merge({name:"Reflex"},a.reflex)],[angular.merge({name:"Action Speed"},a.actionSpeed),angular.merge({name:"Recovery"},a.recovery)],[angular.merge({name:"Critical"},a.critical)]]}t.$watch("character",function(e){if(e){t.statOptionValues={level:[1],superb:[0,1,2,3,4,5]};for(var n=e.value;6>=n;n++)t.statOptionValues.level.push(10*n);t.statOptions={level:1,superb:0,bonus:{power:0,technique:0,vitality:0,speed:0}},t.setBonusStats=function(e){Object.keys(t.statOptions.bonus).forEach(function(n){t.statOptions.bonus[n]=e})},t.getBonusStats=function(){var e=Object.keys(t.statOptions.bonus);return e.reduce(function(e,n){return e+t.statOptions.bonus[n]},0)/e.length},t.positions=[[["LWF"],["ST","SS"],["RWF"]],[["LM","LWM"],["CM","CDM","CAM"],["RM","RWM"]],[["LB","LWB"],["CB"],["RB","RWB"]],[["GK"]]].map(function(t){return t.map(function(t){var n=t.filter(function(t){return-1!==e.positions.indexOf(t)}).pop();return n?{name:n,main:e.positions[0]===n}:null})}),t.stats={power:{name:"Power",color:"red"},technique:{name:"Technique",color:"blue"},vitality:{name:"Vitality",color:"green"},speed:{name:"Speed",color:"violet"}}}}),t.$watch("statOptions",function(e){e&&r(t.character,e)},!0)}}}]),angular.module("app").directive("multiSelect",["$q","Skills",function(e,t){return{restrict:"E",scope:{model:"=ngModel",options:"=options",multiple:"=multiple",required:"=required"},templateUrl:"components/multi-select/multi-select.html",link:function(e,t){e.selectOption=function(t){if(e.multiple){e.model||(e.model=[]);var n=e.model.indexOf(t.value);-1===n?e.model.push(t.value):e.model.splice(n,1)}else e.model===t.value?e.required||delete e.model:e.model=t.value},e.isOptionSelected=function(t){return e.multiple?e.model&&e.model.length>0?-1!==e.model.indexOf(t.value):!1:e.model===t.value},e.required&&e.selectOption(e.options[0])}}}]),angular.module("app").controller("CharacterDetailsController",["$scope","$stateParams","Characters","Calculator","ImageIcons",function(e,t,n,r,a){var i=this;n.get(t.characterId).then(function(e){i.character=e,i.imageIcons={gender:a.get("gender",e.gender),element:a.get("element",e.element),type:a.get("type",e.type),weatherImmunity:a.get("weather",e.weatherImmunity),special:a.get("other","special"),stoneElements:e.stoneElements?e.stoneElements.map(function(e){return a.get("element",e)}):[]},i.tabs={stats:{name:"Stats"},skills:{name:"Skills"},evolution:{name:"Evolution"},chains:{name:"Chains"}},i.selectedTab=Object.keys(i.tabs).shift(),i.tabs={},e.isManager||(i.tabs.stats={name:"Stats"}),i.tabs.skills={name:"Skills"},i.tabs.evolution={name:"Evolution"},e.chain&&(i.tabs.chains={name:"Chains"}),Object.keys(i.tabs).forEach(function(e){var t=i.tabs[e];t.select=function(){i.selectedTab={},i.selectedTab[e]=!0},t.isSelected=function(){return i.selectedTab[e]}}),i.selectedTab={},i.selectedTab[Object.keys(i.tabs).shift()]=!0})}]),angular.module("app").controller("CharactersController",["$scope","$localStorage","Characters","ImageIcons",function(e,t,n,r){var a=this;a.filterValues=t.characterFilterValues,a.filterValues||(a.filterValues={}),a.formatValue=function(e){return Array.isArray(e)?e.join(", "):e};var i={"boolean":{options:[{value:!0},{value:!1}]},element:{options:[{value:"Ardor",image:r.get("element","ardor")},{value:"Whirlwind",image:r.get("element","whirlwind")},{value:"Thunder",image:r.get("element","thunder")},{value:"Light",image:r.get("element","light")},{value:"Dark",image:r.get("element","dark")}]}};a.filters={},a.filters.characterType={name:"Character Type",options:[{value:"Player"},{value:"Manager"},{value:"Other"}],required:!0},a.filters.element=angular.merge({},i.element,{name:"Element",multiple:!0}),a.filters.value={name:"Rarity",options:[{value:2,icon:"star"},{value:3,icon:"star"},{value:4,icon:"star"},{value:5,icon:"star"},{value:6,icon:"star"}],multiple:!0},a.filters.gender={name:"Gender",options:[{value:"Male",image:r.get("gender","male")},{value:"Female",image:r.get("gender","female")}]},a.filters.extremeEvolution=angular.merge({},i["boolean"],{name:"Extreme Evolution"}),a.filters.type={name:"Player Type",options:[{value:"Striker",image:r.get("type","striker")},{value:"Attacker",image:r.get("type","attacker")},{value:"Defender",image:r.get("type","defender")},{value:"Assist",image:r.get("type","assist")},{value:"Leader",image:r.get("type","leader")}],multiple:!0},a.filters.stoneElements=angular.merge({},i.element,{name:"Spirit Stone",multiple:!0}),a.filters.weatherImmunity={name:"Weather Immunity",options:[{value:"Rainy Weather",image:r.get("weather","rainy weather")},{value:"Soul Grave",image:r.get("weather","soul grave")},{value:"Piercing Wind",image:r.get("weather","piercing wind")}],multiple:!0},a.filters.season={name:"Season",options:[{value:1},{value:2}]},a.filters.isSpecial=angular.merge({},i["boolean"],{name:"Special"}),a.skillFilters={ace:{name:"Ace Skill"},active:{name:"Active Skill"},passive:{name:"Passive Skill"}},a.pageLimits=[20,40,60],a.pageLimit=a.pageLimits[0],e.$watch(function(){return a.filterValues},function(e){t.characterFilterValues=a.filterValues,n.getAll(e).then(function(e){var t=a.pageLimits[a.pageLimits.length-1];a.characters=e.slice(0,t)})},!0)}]),angular.module("app").controller("RankingsController",["$scope",function(e){}]),angular.module("app").controller("SpiritStonesController",["$scope","$localStorage","SpiritStones","ImageIcons",function(e,t,n,r){var a=this;a.filterValues=t.spiritStoneFilterValues,a.filterValues||(a.filterValues={}),a.filters={},a.filters.element={name:"Element",options:[{value:"Ardor",image:r.get("element","ardor")},{value:"Whirlwind",image:r.get("element","whirlwind")},{value:"Thunder",image:r.get("element","thunder")},{value:"Light",image:r.get("element","light")},{value:"Dark",image:r.get("element","dark")}]},a.filters.rarity={name:"Rarity",options:[{value:"Common"},{value:"Rare"},{value:"Unique"}]},a.filters.zodiac={name:"Zodiac",options:["Aquarius","Aries","Cancer","Capricorn","Gemini","Leo","Libra","Pisces","Sagittarius","Scorpio","Taurus","Virgo"].map(function(e){return{value:e,image:r.get("stone",e)}})},e.$watch(function(){return a.filterValues},function(e){t.spiritStoneFilterValues=a.filterValues,n.getAll(e).then(function(e){a.spiritStones=e})},!0)}]);
//# sourceMappingURL=bundle.min.js.map
