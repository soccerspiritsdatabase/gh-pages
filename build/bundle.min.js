angular.module("app",["templates","ui.router","ngStorage"]),angular.module("app").config(["$compileProvider","$stateProvider","$urlRouterProvider",function(e,t,n){e.debugInfoEnabled(!1),n.otherwise("/characters"),t.state("characters",{url:"/characters",templateUrl:"routes/characters/characters.html",controller:"CharactersController as ctrl"}).state("character-details",{url:"/characters/details/:characterId",templateUrl:"routes/character-details/character-details.html",controller:"CharacterDetailsController as ctrl"}).state("spirit-stones",{url:"/spiritstones",templateUrl:"routes/spirit-stones/spirit-stones.html",controller:"SpiritStonesController as ctrl"}).state("rankings",{url:"/rankings",templateUrl:"routes/rankings/rankings.html",controller:"RankingsController as ctrl"})}]),angular.module("app").service("Cache",["$cacheFactory",function(e){var t=e("resource"),n=this;n.get=function(e){return t.get(e)},n.put=function(e,n){t.put(e,n)}}]),angular.module("app").service("Calculator",function(){function e(e,t){return t/10>e&&(e=Math.ceil(t/10)),Math.min(1,Math.pow(.176,(6-e)/10))}function t(e,t){return isNaN(t)?Math.round(e):Math.round(e*t)/t}var n=this,a=60,r={LWF:{dribble:.1,hp:.05,actionSpeed:.1,critical:.05},ST:{dribble:.1,actionSpeed:.05,critical:.1,steal:.05},SS:{dribble:.05,defense:.05,actionSpeed:.1,critical:.05,reflex:.05},RWF:{dribble:.1,hp:.05,actionSpeed:.1,critical:.05},LWM:{dribble:.05,hp:.05,recovery:.05,actionSpeed:.05,critical:.05,reflex:.05,pass:.05},CAM:{dribble:.05,recovery:.05,actionSpeed:.05,critical:.1,reflex:.05,pass:.05},CM:{dribble:.05,defense:.05,recovery:.1,reflex:.05,pass:.1,steal:.05},RWM:{dribble:.05,hp:.05,recovery:.05,actionSpeed:.05,critical:.05,reflex:.05,pass:.05},LM:{dribble:.05,defense:.05,recovery:.1,reflex:.05,pass:.1,steal:.05},RM:{dribble:.05,defense:.05,recovery:.1,reflex:.05,pass:.1,steal:.05},CDM:{defense:.1,hp:.05,reflex:.1,steal:.05},LWB:{dribble:.05,defense:.05,hp:.05,recovery:.05,reflex:.1,pass:.05},RWB:{dribble:.05,defense:.05,hp:.05,recovery:.05,reflex:.1,pass:.05},LB:{defense:.05,hp:.1,recovery:.05,reflex:.05,pass:.05,steal:.05},CB:{defense:.1,hp:.1,reflex:.05,steal:.05},RB:{defense:.05,hp:.1,recovery:.05,reflex:.05,pass:.05,steal:.05},GK:{defense:.15,hp:.3,steal:.05}};n.calcPrimaryStat=function(t,n,r,i,l){var o=Math.floor(t[n].min*e(t.value,r)),s=t[n].max,c=s-o,u=c/(a-1),m=Math.floor(o+u*(r-1));return!isNaN(i)&&i>0&&(m=Math.floor(m+.1*m*i)),!isNaN(l)&&l>0&&(m=Math.floor(m+l)),m},n.calcSecondaryStats=function(e,n,a,i,l,o){var s={dribble:{value:Math.floor(5+e+.2*i)},defense:{value:Math.floor(.2*a+.8*n)},steal:{value:Math.floor(5+n+.2*i)},hp:{value:Math.floor(20+.8*l+Math.round(1.8*a))},pass:{value:Math.floor(3+.8*n)},reflex:{value:Math.floor((5+n+i/12)/4/(l+30)*1e3)},actionSpeed:{value:Math.floor(30+.1*i)},recovery:{value:.03+.002*(e+a)},critical:{value:.05+.001*(.3*e+.8*n+.4*i)}};if(o&&o.name&&r[o.name]){var c=r[o.name];Object.keys(c).forEach(function(e){var t=c[e];t*=o.main?2:1.5,"critical"===e?s[e].value+=t:(s[e].value+=s[e].value*t,"recovery"!==e&&(s[e].value=Math.floor(s[e].value))),s[e].positionBuff=!0})}return s.recovery.value=t(s.recovery.value,100),s.critical.value=t(100*s.critical.value,10)+"%",s}}),angular.module("app").service("Characters",["$http","$q","Skills","Calculator",function(e,t,n,a){var r,i,l,o=this,s=e.get("data/json_files/characters.json").success(function(e){r=e,Object.keys(r).forEach(function(e){var t={};["power","technique","vitality","speed"].map(function(n){t[n]=a.calcPrimaryStat(r[e],n,60,5,40)});var n=a.calcSecondaryStats(t.power,t.technique,t.vitality,t.speed,60);r[e].primaryStats=t,r[e].secondaryStats=n}),i=Object.keys(r).map(function(e){return r[e]}).sort(function(e,t){return e.name.en<t.name.en?-1:e.name.en>t.name.en?1:e.value>t.value?-1:e.value<t.value?1:e.id<t.id?-1:e.id>t.id?1:0}),l=i.filter(function(e){return e.power.ranking})});o.get=function(e){return s.then(function(){return angular.copy(r[e])})},o.getAll=function(e,t){var a=[];if(e.name){var r=new RegExp(e.name.split(/\s+/).join(".*"),"i");a.push(function(e){return e.name.en.match(r)})}["characterType","gender","type","element","value","stoneElements","season","weatherImmunity"].forEach(function(t){e[t]&&a.push(function(n){if(!n[t])return!1;if(Array.isArray(e[t])){if(0===e[t].length)return!0;var a="stoneElements"===t?"every":"some";return e[t][a](function(e){return Array.isArray(n[t])?n[t].some(function(t){return t==e}):n[t]==e})}return Array.isArray(n[t])?n[t].some(function(n){return n==e[t]}):n[t]==e[t]})}),["isSpecial"].forEach(function(t){"boolean"==typeof e[t]&&a.push(function(n){return n[t]==e[t]})}),a.push(function(t){return void 0!==e.extremeEvolution&&t.isPlayer?e.extremeEvolution?t.id>=3e4&&t.id<4e4:t.id>=2e4&&t.id<3e4&&!t.evolution:t.isPlayer||t.isManager?!t.evolution:!0});var l=s;return e.skill&&(e.skill.ace&&(l=l.then(function(){return n.getAll({type:"Ace",description:e.skill.ace})}).then(function(e){a.push(function(t){return t.skills.ace&&e.some(function(e){return e.id===t.skills.ace})})})),e.skill.active&&(l=l.then(function(){return n.getAll({type:"Active",description:e.skill.active})}).then(function(e){a.push(function(t){return t.skills.active&&e.some(function(e){return e.id===t.skills.active})})})),e.skill.passive&&(l=l.then(function(){return n.getAll({type:"Passive",description:e.skill.passive})}).then(function(e){a.push(function(t){return t.skills.passives&&e.some(function(e){return t.skills.passives.some(function(t){return t===e.id})})})}))),l.then(function(){var e;return e=a.reduce(function(e,t){return e.filter(t)},i),t&&"name"!==t&&(console.log(t),-1!==["power","technique","vitality","speed"].indexOf(t)&&(e=e.sort(function(e,n){return e.primaryStats[t]>n.primaryStats[t]?-1:e.primaryStats[t]<n.primaryStats[t]?1:0})),-1!==["dribble","defense","steal","hp","pass","reflex","actionSpeed"].indexOf(t)&&(e=e.sort(function(e,n){return e.secondaryStats[t].value>n.secondaryStats[t].value?-1:e.secondaryStats[t].value<n.secondaryStats[t].value?1:0}))),e})},o.getRanking=function(e){return s.then(function(){return l.slice().sort(function(t,n){return t[e].ranking<n[e].ranking?-1:t[e].ranking>n[e].ranking?1:0})})}}]),angular.module("app").service("Evolutions",["$http","$q","Characters",function(e,t,n){function a(e){return e?t.all(e.materials.map(function(e){return n.get(e.character)})).then(function(t){return e.materials.forEach(function(e,n){e.character=t[n]}),e}):null}var r,i,l=this,o=e.get("data/json_files/evolutions.json").success(function(e){r=e,i=Object.keys(r).map(function(e){return r[e]})});l.get=function(e){return o.then(function(){for(var t=0;t<i.length;t++)if(i[t].preResult===e)return a(angular.copy(i[t]));return null})},l.reverse=function(e){return o.then(function(){for(var t=0;t<i.length;t++)if(i[t].result===e)return a(angular.copy(i[t]));return null})}}]),angular.module("app").service("ImageIcons",function(){var e=this;e.get=function(e,t){return e&&t?["img/icons/",e.toLowerCase(),"/",t.toLowerCase(),".png"].join(""):""}}),angular.module("app").service("Skills",["$http","$q",function(e,t){var n,a,r=this,i=e.get("data/json_files/skills.json").success(function(e){n=e,a=Object.keys(n).map(function(e){return n[e]})});r.get=function(e){return i.then(function(){return angular.copy(n[e])})},r.getAll=function(e){var t=[];if(["type"].forEach(function(n){e[n]&&t.push(function(t){return t[n]===e[n]})}),e.description)try{var n=e.description.split(/\s+/).map(function(e){return new RegExp(e,"i")});t.push(function(e){return n.every(function(t){return e.description.en.match(t)})})}catch(r){}return i.then(function(){var e;return e=t.reduce(function(e,t){return e.filter(t)},a)})}}]),angular.module("app").service("SpiritStones",["$http","$q","Skills","ImageIcons",function(e,t,n,a){var r,i,l=this,o=e.get("data/json_files/spiritStones.json").success(function(e){i=e,r=Object.keys(i).map(function(e){return i[e]}).filter(function(e){return e.value>=6}).sort(function(e,t){return e.name.en<t.name.en?-1:e.name.en>t.name.en?1:e.value<t.value?-1:e.value>t.value?1:e.id<t.id?-1:e.id>t.id?1:0}),r.forEach(function(e){"Unique"===e.rarity?e.iconImage=a.get("stone",e.iconImage):e.iconImage=a.get("stone",e.element+"-"+e.rarity),e.zodiac&&(e.zodiacImage=a.get("stone",e.zodiac))})});l.getAll=function(e){e||(e={});var t=[];if(e.name){var a=new RegExp(e.name.split(/\s+/).join(".+"),"i");t.push(function(e){return e.name.en.match(a)})}["element","zodiac","rarity"].forEach(function(n){e[n]&&t.push(function(t){return t[n]===e[n]})});var i=o;return e.skill&&(i=i.then(function(){return n.getAll({type:"Item",description:e.skill})}).then(function(e){t.push(function(t){return t.skills.some(function(t){return e.some(function(e){return e.id===t})})})})),i.then(function(){return t.reduce(function(e,t){return e.filter(t)},r)})}}]),angular.module("app").service("TimeLogger",["$http","$q",function(e,t){var n=this,a={};n.start=function(e){a[e]=(new Date).getTime()},n.end=function(e){console.log("[TimeLogger]",e,(new Date).getTime()-a[e]+"ms")}}]),angular.module("app").directive("characterCard",["$window","$timeout","Characters",function(e,t,n){return{restrict:"E",scope:{model:"=ngModel"},templateUrl:"components/character-card/character-card.html",link:function(t,a){function r(e){t.character=e,t.image={},t.image.character="data/card_files/"+t.character.imageId+"_CS.jpg",t.image.star="img/icons/star/";var n=Math.floor(t.character.id/1e4)%3;e.isOther||1===n?t.image.star+="normal":2===n?t.image.star+="evolved":t.image.star+="extreme-evolved",t.image.star+=".png",t.stars=[];for(var a=0;a<t.character.value;a++)t.stars.push(a)}function i(e){t.fontSize=Math.min(25,a[0].clientWidth/10)+"px",e&&t.$apply()}t.$watch("model",function(e){e&&(isNaN(e)?r(e):n.get(e).then(r))}),t.calculateFontSize=i,e.addEventListener("resize",i),t.$on("$destroy",function(){e.removeEventListener("resize",i)})}}}]),angular.module("app").directive("characterChainsTab",["Calculator",function(e){return{restrict:"E",scope:{character:"=ngModel"},templateUrl:"components/character-chains-tab/character-chains-tab.html",link:function(e,t){e.$watch("character",function(t){t&&t.chain&&t.chain.chains&&(e.chains=t.chain.chains)})}}}]),angular.module("app").directive("characterEvolutionTab",["$q","Evolutions",function(e,t){function n(e){return t.reverse(e).then(function(t){return t?n(t.preResult):e})}function a(e,n){return n||(n=[]),t.get(e).then(function(e){return e?(n.push(e),a(e.result,n)):n})}return{restrict:"E",scope:{character:"=ngModel"},templateUrl:"components/character-evolution-tab/character-evolution-tab.html",link:function(e,t){e.$watch("character",function(t){t&&n(t.id).then(function(e){return a(e)}).then(function(t){e.evolutions=t})})}}}]),angular.module("app").directive("characterSkill",["$q","Skills",function(e,t){return{restrict:"E",scope:{skillId:"=ngModel"},templateUrl:"components/character-skill/character-skill.html",link:function(e,n){e.$watch("skillId",function(n){n&&t.get(n).then(function(t){e.skill=t,e.levelIndex=t.effects.length-1,t.cooldown>60?e.cooldown={value:t.cooldown/3600,unit:" hour"}:e.cooldown={value:t.cooldown,unit:" min"},1!==e.cooldown.value&&(e.cooldown.unit+="s")})})}}}]),angular.module("app").directive("characterSkillsTab",["$q","Skills",function(e,t){return{restrict:"E",scope:{character:"=ngModel"},templateUrl:"components/character-skills-tab/character-skills-tab.html",link:function(e,t){}}}]),angular.module("app").directive("characterStatsTab",["Calculator",function(e){return{restrict:"E",scope:{character:"=ngModel"},templateUrl:"components/character-stats-tab/character-stats-tab.html",link:function(t,n){function a(n,a){["power","technique","vitality","speed"].forEach(function(r){t.stats[r].value=e.calcPrimaryStat(n,r,a.level,a.superb,a.bonus[r])});var r=e.calcSecondaryStats(t.stats.power.value,t.stats.technique.value,t.stats.vitality.value,t.stats.speed.value,a.level,a.position);t.secondaryStats=[[angular.merge({name:"Dribble"},r.dribble),angular.merge({name:"Defense"},r.defense)],[angular.merge({name:"Steal"},r.steal),angular.merge({name:"HP"},r.hp)],[angular.merge({name:"Pass"},r.pass),angular.merge({name:"Reflex"},r.reflex)],[angular.merge({name:"Action Speed"},r.actionSpeed),angular.merge({name:"Recovery"},r.recovery)],[angular.merge({name:"Critical"},r.critical)]]}t.$watch("character",function(e){if(e){t.statOptionValues={level:[1],superb:[0,1,2,3,4,5]};for(var n=e.value;6>=n;n++)t.statOptionValues.level.push(10*n);t.statOptions={level:1,superb:0,bonus:{power:0,technique:0,vitality:0,speed:0}},t.setBonusStats=function(e){Object.keys(t.statOptions.bonus).forEach(function(n){t.statOptions.bonus[n]=e})},t.getBonusStats=function(){var e=Object.keys(t.statOptions.bonus);return e.reduce(function(e,n){return e+t.statOptions.bonus[n]},0)/e.length},t.positions=[[["LWF"],["ST","SS"],["RWF"]],[["LM","LWM"],["CM","CDM","CAM"],["RM","RWM"]],[["LB","LWB"],["CB"],["RB","RWB"]],[["GK"]]].map(function(t){return t.map(function(t){var n=t.filter(function(t){return-1!==e.positions.indexOf(t)}).pop();return n?{name:n,main:e.positions[0]===n}:null})}),t.stats={power:{name:"Power",color:"red"},technique:{name:"Technique",color:"blue"},vitality:{name:"Vitality",color:"green"},speed:{name:"Speed",color:"violet"}}}}),t.$watch("statOptions",function(e){e&&a(t.character,e)},!0)}}}]),angular.module("app").directive("multiSelect",["$q","Skills",function(e,t){return{restrict:"E",scope:{model:"=ngModel",options:"=options",multiple:"=multiple",required:"=required"},templateUrl:"components/multi-select/multi-select.html",link:function(e,t){e.selectOption=function(t){if(e.multiple){e.model||(e.model=[]);var n=e.model.indexOf(t.value);-1===n?e.model.push(t.value):e.model.splice(n,1)}else e.model===t.value?e.required||delete e.model:e.model=t.value},e.isOptionSelected=function(t){return e.multiple?e.model&&e.model.length>0?-1!==e.model.indexOf(t.value):!1:e.model===t.value},void 0===e.model&&e.required&&e.selectOption(e.options[0])}}}]),angular.module("app").directive("onImageLoad",function(){return{restrict:"A",link:function(e,t,n){function a(){e.$apply(n.onImageLoad)}t.bind("load",a),e.$on("$destroy",function(){t.unbind("load",a)})}}}),angular.module("app").controller("CharacterDetailsController",["$scope","$stateParams","Characters","Calculator","ImageIcons",function(e,t,n,a,r){var i=this;n.get(t.characterId).then(function(e){i.character=e,i.imageIcons={gender:r.get("gender",e.gender),element:r.get("element",e.element),type:r.get("type",e.type),weatherImmunity:r.get("weather",e.weatherImmunity),special:r.get("other","special"),stoneElements:e.stoneElements?e.stoneElements.map(function(e){return r.get("element",e)}):[]},i.tabs={stats:{name:"Stats"},skills:{name:"Skills"},evolution:{name:"Evolution"},chains:{name:"Chains"}},i.selectedTab=Object.keys(i.tabs).shift(),i.tabs={},e.isManager||(i.tabs.stats={name:"Stats"}),i.tabs.skills={name:"Skills"},i.tabs.evolution={name:"Evolution"},e.chain&&(i.tabs.chains={name:"Chains"}),Object.keys(i.tabs).forEach(function(e){var t=i.tabs[e];t.select=function(){i.selectedTab={},i.selectedTab[e]=!0},t.isSelected=function(){return i.selectedTab[e]}}),i.selectedTab={},i.selectedTab[Object.keys(i.tabs).shift()]=!0}),e.$on("$stateChangeSuccess",function(){document.documentElement.scrollTop=document.body.scrollTop=0})}]),angular.module("app").controller("CharactersController",["$scope","$timeout","$localStorage","Cache","Characters","ImageIcons",function(e,t,n,a,r,i){function l(){n.characterFilterValues=o.filterValues,r.getAll(o.filterValues,o.sortBy).then(function(e){var t=o.pageLimits[o.pageLimits.length-1];o.characters=e.slice(0,t)})}var o=this;o.filterValues=n.characterFilterValues,o.filterValues||(o.filterValues={}),o.formatValue=function(e){return Array.isArray(e)?e.join(", "):e};var s={"boolean":{options:[{value:!0},{value:!1}]},element:{options:[{value:"Ardor",image:i.get("element","ardor")},{value:"Whirlwind",image:i.get("element","whirlwind")},{value:"Thunder",image:i.get("element","thunder")},{value:"Light",image:i.get("element","light")},{value:"Dark",image:i.get("element","dark")}]}};o.filters={},o.filters.characterType={name:"Character Type",options:[{value:"Player"},{value:"Manager"},{value:"Other"}],required:!0},o.filters.element=angular.merge({},s.element,{name:"Element",multiple:!0}),o.filters.value={name:"Rarity",options:[{value:2,icon:"star"},{value:3,icon:"star"},{value:4,icon:"star"},{value:5,icon:"star"},{value:6,icon:"star"}],multiple:!0},o.filters.gender={name:"Gender",options:[{value:"Male",image:i.get("gender","male")},{value:"Female",image:i.get("gender","female")}]},o.filters.extremeEvolution=angular.merge({},s["boolean"],{name:"Extreme Evolution"}),o.filters.type={name:"Player Type",options:[{value:"Striker",image:i.get("type","striker")},{value:"Attacker",image:i.get("type","attacker")},{value:"Defender",image:i.get("type","defender")},{value:"Assist",image:i.get("type","assist")},{value:"Leader",image:i.get("type","leader")},{value:"Goal Keeper",image:i.get("type","goal keeper")}],multiple:!0},o.filters.stoneElements=angular.merge({},s.element,{name:"Spirit Stone",multiple:!0}),o.filters.weatherImmunity={name:"Weather Immunity",options:[{value:"Rainy Weather",image:i.get("weather","rainy weather")},{value:"Soul Grave",image:i.get("weather","soul grave")},{value:"Piercing Wind",image:i.get("weather","piercing wind")}],multiple:!0},o.filters.season={name:"Season",options:[{value:1},{value:2}]},o.filters.isSpecial=angular.merge({},s["boolean"],{name:"Special"}),o.skillFilters={ace:{name:"Ace Skill"},active:{name:"Active Skill"},passive:{name:"Passive Skill"}},o.pageLimits=[20,40,60],o.pageLimit=o.pageLimits[0],o.layouts=["grid","list"],o.layout=o.layouts[0],o.getImageIcon=function(e,t){return i.get(e,t)},e.$watch(function(){return o.sortBy},l),e.$watch(function(){return o.layout},function(){delete o.sortBy}),e.$watch(function(){return o.filterValues},l,!0),e.$on("$stateChangeSuccess",function(){var e=a.get("charactersState:scrollTop")||0;t(function(){document.documentElement.scrollTop=document.body.scrollTop=e},0)}),e.$on("$stateChangeStart",function(){var e=document.documentElement.scrollTop||document.body.scrollTop||0;a.put("charactersState:scrollTop",e)})}]),angular.module("app").controller("RankingsController",["$q","Characters",function(e,t){var n=this;n.limits=[10,25,50,100],n.limit=n.limits[0],n.stats=["power","technique","vitality","speed"],n.statNames={power:"Power",technique:"Technique",vitality:"Vitality",speed:"Speed"},n.ranking={},["power","technique","vitality","speed"].forEach(function(e){t.getRanking(e).then(function(t){n.ranking[e]=t})})}]),angular.module("app").controller("SpiritStonesController",["$scope","$localStorage","SpiritStones","ImageIcons",function(e,t,n,a){var r=this;r.filterValues=t.spiritStoneFilterValues,r.filterValues||(r.filterValues={}),r.filters={},r.filters.element={name:"Element",options:[{value:"Ardor",image:a.get("element","ardor")},{value:"Whirlwind",image:a.get("element","whirlwind")},{value:"Thunder",image:a.get("element","thunder")},{value:"Light",image:a.get("element","light")},{value:"Dark",image:a.get("element","dark")}]},r.filters.rarity={name:"Rarity",options:[{value:"Common"},{value:"Rare"},{value:"Unique"}]},r.filters.zodiac={name:"Zodiac",options:["Aquarius","Aries","Cancer","Capricorn","Gemini","Leo","Libra","Pisces","Sagittarius","Scorpio","Taurus","Virgo"].map(function(e){return{value:e,image:a.get("stone",e)}})},e.$watch(function(){return r.filterValues},function(e){t.spiritStoneFilterValues=r.filterValues,n.getAll(e).then(function(e){r.spiritStones=e})},!0)}]);
//# sourceMappingURL=bundle.min.js.map
